{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user of the Daily Planner Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "name": {
          "type": "string",
          "description": "The user's name."
        },
        "subjectIds": {
          "type": "array",
          "description": "References to Subjects the user has selected. (Relationship: UserProfile 1:N Subject)",
          "items": {
            "type": "string"
          }
        },
        "notificationTime": {
          "type": "string",
          "description": "The time the user wants to be notified about upcoming tasks. Stored as a string in HH:MM format.",
          "format": "string"
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Subject": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subject",
      "type": "object",
      "description": "Represents a subject that a user can select.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Subject entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the subject (e.g., Mathematics, Biology)."
        },
        "daysOfWeek": {
          "type": "array",
          "description": "An array of strings representing the days of the week the subject is taught (e.g., ['Monday', 'Wednesday', 'Friday']).",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "daysOfWeek"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task or homework assignment for a specific subject.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Task entity."
        },
        "subjectId": {
          "type": "string",
          "description": "Reference to the Subject the task belongs to. (Relationship: Subject 1:N Task)"
        },
        "dueDate": {
          "type": "string",
          "description": "The date and time the task is due.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the task."
        },
        "isCompleted": {
          "type": "boolean",
          "description": "Indicates whether the task has been completed."
        }
      },
      "required": [
        "id",
        "subjectId",
        "dueDate",
        "description",
        "isCompleted"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Collection of user profiles. Uses path-based ownership for security.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/subjects/{subjectId}",
        "definition": {
          "entityName": "Subject",
          "schema": {
            "$ref": "#/backend/entities/Subject"
          },
          "description": "Subcollection of subjects for each user. Uses path-based ownership for security.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "subjectId",
              "description": "The unique identifier of the subject."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Subcollection of tasks for each user. Uses path-based ownership for security.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "taskId",
              "description": "The unique identifier of the task."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a simple, scalable, and secure way to manage user profiles, subjects, and tasks in the Daily Planner Pro application. It prioritizes authorization independence and clarity for easy debugging and maintenance. The structure uses path-based ownership for user-specific data and avoids hierarchical authorization dependencies by storing all authorization data directly in the documents.\n\n**Authorization Independence:** Authorization independence is achieved by leveraging path-based ownership for `UserProfile`, `Subject`, and `Task` collections. Each user has their own dedicated space under `/users/{userId}`, ensuring that access control can be determined directly from the path without needing to `get()` data from parent documents.\n\n**Structural Segregation (Homogeneous Security Posture):** All documents in the collections are segregated by the user's ID, thus sharing the same security requirements. Only the user should be able to read/write data in their path.\n\n**QAPs Support:** The design supports secure `list` operations. Since each user's data is segregated under their respective `/users/{userId}` path, listing operations can be performed securely within that scope without exposing data from other users. Path-based ownership ensures that rules can easily filter based on the requesting user's ID.\n\n**Invariants:** The structure supports invariants such as ownership by using path-based ownership and timestamps, which can be added to the entities."
  }
}